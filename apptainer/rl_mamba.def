Bootstrap: docker
From: mambaorg/micromamba

%files
    cmake
    deburring-mpc
    deburring-python-utils

%post
    apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y \
        cmake
    micromamba env create --yes --quiet -f deburring-python-utils/environment.yaml
    micromamba clean --all --yes
    micromamba run -n talos-rl python -m pip install ./deburring-python-utils

    cmake -B deburring-mpc/build -S deburring-mpc \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_PREFIX_PATH=/opt/conda/envs/talos-rl/ \
            -DCMAKE_INSTALL_PREFIX=/opt/conda/envs/talos-rl/
    cd deburring-mpc/build
    make install

%apprun training_mpc
    exec micromamba run -n talos-rl python -m gym_talos.training_MPC -config /config/config_MPC_RL.yaml

%apprun benchmark
    exec micromamba run -n talos-rl python -m deburring_benchmark